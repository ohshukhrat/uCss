name: uCss Build & Deploy

on:
  push:
    branches: [ "main" ] # Runs on every edit
  release:
    types: [published]   # Runs when you tag a release (v1.0)

jobs:
  build-and-deploy:
    name: üöÄ Build uCss
    runs-on: ubuntu-latest
    steps:
      # 1. Get your code from GitHub
      - name: üöö Checkout Code
        uses: actions/checkout@v4

      # 2. The Build Process (3 Files Generated)
      - name: üèóÔ∏è Build & Optimize
        run: |
          # Run the build script
          chmod +x build.sh
          ./build.sh

      # 3. Determine Server Folder
      - name: üìÇ Set Server Path
        id: target
        run: |
          if [[ "${{ github.event_name }}" == "release" ]]; then
            echo "dir=${{ github.ref_name }}/" >> $GITHUB_OUTPUT
          else
            echo "dir=latest/" >> $GITHUB_OUTPUT
          fi

      # 4. Upload to Server
      - name: ‚òÅÔ∏è Upload via FTP
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: "${{ secrets.FTP_SERVER }}"
          username: "${{ secrets.FTP_USERNAME }}"
          password: "${{ secrets.FTP_PASSWORD }}"
          local-dir: ./dist/      # Uploads the entire 'dist' folder (all 3 files)
          server-dir: ./${{ steps.target.outputs.dir }}