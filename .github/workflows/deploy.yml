name: uCss Build & Deploy

on:
  push:
    branches: [ "main" ] # Runs on every save to main branch
  release:
    types: [published]   # Runs when you publish a release (v1.0)

jobs:
  build-and-deploy:
    name: üöÄ Build uCss
    runs-on: ubuntu-latest
    steps:
      # 1. Get your code
      - name: üöö Checkout Code
        uses: actions/checkout@v4

      # 2. Build, Minify, and Gzip
      - name: üèóÔ∏è Build & Optimize
        run: |
          # Create output folder
          mkdir -p dist

          # A. Combine all CSS files into one readable file (u.css)
          # Note: Files are loaded alphabetically. 
          # To force order, rename files like 01-set.css, 02-f.css, etc.
          cat src/css/*.css > dist/u.css

          # B. Install Minifier Tool (CleanCSS)
          npm install -g clean-css-cli

          # C. Generate Minified Version (u.min.css)
          # --level 1: Removes comments/whitespace but strictly preserves rule order
          cleancss --level 1 -o dist/u.min.css dist/u.css

          # D. Generate Gzip Version (u.min.css.gz)
          # -9: Max compression, -k: Keep original file
          gzip -9 -k dist/u.min.css

      # 3. Determine Target Folder (latest vs v1.0)
      - name: üìÇ Set Server Path
        id: target
        run: |
          if [[ "${{ github.event_name }}" == "release" ]]; then
            echo "dir=${{ github.ref_name }}/" >> $GITHUB_OUTPUT
          else
            echo "dir=latest/" >> $GITHUB_OUTPUT
          fi

      # 4. Upload to Server
      - name: ‚òÅÔ∏è Upload via FTP
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: "${{ secrets.FTP_SERVER }}"
          username: "${{ secrets.FTP_USERNAME }}"
          password: "${{ secrets.FTP_PASSWORD }}"
          local-dir: ./dist/      # Uploads u.css, u.min.css, and u.min.css.gz
          server-dir: ./${{ steps.target.outputs.dir }}