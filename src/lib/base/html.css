/**
 * @file HTML Reset & Defaults
 * @description Global element normalization. 
 * Connects "naked" HTML tags to the design system variables defined in config.css.
 * Now powered by "Smart Flow" variables for perfect vertical rhythm.
 * 
 * @usage
 * Load after config.css.
 * All selectors use :where() to maintain 0 specificity.
 */

/* ==========================================================================
   1. GLOBAL RESET & BOX SIZING
   ========================================================================== */

:where(*),
:where(*::before),
:where(*::after) {
    box-sizing: border-box;
    background-repeat: no-repeat;
    min-width: 0;
}

:where(html) {
    scroll-behavior: smooth;
    -webkit-text-size-adjust: 100%;
    -moz-tab-size: 4;
    tab-size: 4;
}

@media (prefers-reduced-motion: reduce) {
    :where(html) {
        scroll-behavior: auto;
    }
}

/* ==========================================================================
   2. BODY & ROOT DEFAULTS
   ========================================================================== */

:where(body) {
    background-color: var(--bg, #ffffff);
    color: var(--tx, #000000);

    font-family: var(--tx-font-fam, system-ui, -apple-system, sans-serif);
    font-size: var(--body-font-size, var(--body-fs, var(--tx-fs, var(--tx-fs--s, 1rem))));
    line-height: var(--tx-lh, 1.5);
    font-weight: var(--tx-fw, 400);

    margin: 0;
    padding: 0;

    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* ==========================================================================
   3. TYPOGRAPHY & SMART FLOW
   ========================================================================== */

/* Headings: Map to --t (Title) variables */
:where(h1, h2, h3, h4, h5, h6) {
    color: var(--t, currentColor);
    font-family: var(--t-font-fam, inherit);
    font-weight: var(--t-fw--m, 700);
    line-height: var(--t-lh, 1.1);
    text-wrap: balance;

    /* Remove default margins, handled by flow */
    margin-block: 0;
}

/* Specific Sizes */
:where(h1) {
    font-size: var(--heading-font-size, var(--h-fs, var(--h-fs--m, var(--t-fs, var(--t-fs--m, 3rem)))));
}

:where(h2) {
    font-size: var(--heading-font-size, var(--h-fs, var(--h-fs--s, var(--t-fs, var(--t-fs--s, 2.625rem)))));
}

:where(h3) {
    font-size: var(--heading-font-size, var(--h-fs, var(--h-fs--xs, var(--t-fs, var(--t-fs--xs, 2.25rem)))));
}

:where(h4) {
    font-size: var(--heading-font-size, var(--h-fs, var(--h-fs--xxs, var(--t-fs, var(--t-fs--xxs, 2rem)))));
}

:where(h5) {
    font-size: var(--heading-font-size, var(--h-fs, var(--h-fs--xxxs, var(--t-fs, var(--t-fs--xxxs, 1.75rem)))));
}

:where(h6) {
    font-size: var(--heading-font-size, var(--h-fs, var(--h-fs--xxl, var(--t-fs, var(--t-fs--xxl, 1.625rem)))));
}

/* Paragraphs & Text */
:where(p) {
    margin-block: 0;
    max-width: var(--flow-max-width, 65ch);
}

:where(small) {
    font-size: 0.875em;
}

:where(b, strong) {
    font-weight: 700;
    color: var(--t, currentColor);
}

/* --- SMART FLOW LOGIC (The Engine) --- */

/* 1. Standard Flow (Paragraphs, Lists) */
:where(p, ul, ol, blockquote, figure, pre, table)+ :where(p, ul, ol, blockquote, figure, pre, table) {
    margin-block-start: var(--p-flow, 1em);
}

/* 2. Heading Flow */
/* Space BEFORE headings (if not first child) */
:where(*:not(h1, h2, h3, h4, h5, h6))+ :where(h1, h2, h3, h4, h5, h6) {
    margin-block-start: var(--t-flow-s, 1.5em);
}

/* Space AFTER headings (connecting to text) */
:where(h1, h2, h3, h4, h5, h6)+ :where(p, ul, ol, blockquote, figure, pre, table) {
    margin-block-start: var(--t-flow-e, 0.5em);
}

/* 3. List Item Flow */
:where(li)+ :where(li) {
    margin-block-start: var(--li-flow, 0.5em);
}

/* 4. Button/Link After Flow */
:where(p)+ :where(a, button, .btn) {
    margin-block-start: var(--p-flow, 1em);
}

/* Links */
:where(a) {
    color: var(--alt--bd, var(--p, #eec14c));
    text-decoration: underline;
    text-decoration-thickness: 1px;
    text-underline-offset: 0.2em;
    transition: color var(--trans-d, 0.2s) ease;
}

:where(a:hover) {
    color: var(--a, #eec14c);
}

/* Inline Code */
:where(code, kbd, samp) {
    font-family: var(--mono-font, monospace);
    font-size: 0.9em;
    padding: 0.1em 0.3em;
    border-radius: var(--code-rad, var(--rad-xs, 0.25em));
    background-color: var(--code-bg, var(--srf, #eee));
    color: var(--code-tx, var(--t, #000));
}

/* Preformatted blocks */
:where(pre) {
    background-color: var(--pre-bg, var(--d, #222));
    color: var(--pre-tx, var(--l, #fff));
    padding: var(--pre-pd, var(--gap, 1.5rem));
    border-radius: var(--rad, 0.5rem);
    overflow-x: auto;
    font-family: var(--mono-font, monospace);
    font-size: 0.9em;
    /* Margin handled by Smart Flow */
    margin-block: 0;
}

:where(hr) {
    border: none;
    border-block-start: var(--hr-h, 1px) solid var(--hr-c, var(--out, #ccc));
    margin-block: var(--hr-m, 2.5rem);
}

:where(blockquote) {
    border-inline-start: var(--bq-bd-w, calc(var(--border-width, .125rem) * 2)) solid var(--bq-bd-c, var(--p, currentColor));
    margin-inline: 0;
    padding-inline: var(--bq-pd, 1.5em);
    padding-block: .5em;
    font-style: italic;
    color: var(--alt-bd, currentColor);
    /* Margin handled by Smart Flow */
    margin-block: 0;
}

/* Selection Color */
::selection {
    background-color: var(--p, #eec14c);
    color: var(--on-p, #000);
}

/* ==========================================================================
   4. MEDIA
   ========================================================================== */

:where(img, picture, video, canvas, svg) {
    display: block;
    max-width: 100%;
    height: auto;
    font-style: italic;
    shape-margin: 1rem;
}

:where(img) {
    background-color: var(--srf, transparent);
}

/* ==========================================================================
   5. LISTS
   ========================================================================== */

:where(ul, ol) {
    padding-inline-start: 1.5em;
    margin-block: 0;
    /* Handled by Smart Flow */
}

:where(li) {
    margin-block-end: 0;
    /* Handled by Smart Flow */
}

:where(li::marker) {
    color: var(--p, currentColor);
    font-weight: bold;
}

/* ==========================================================================
   6. FORMS
   ========================================================================== */

:where(input, button, textarea, select) {
    font: inherit;
    color: inherit;
    letter-spacing: inherit;
}

:where(input:not([type="button"], [type="submit"], [type="reset"], [type="checkbox"], [type="radio"]), select, textarea) {
    display: block;
    width: 100%;
    padding: 0.625em 1em;
    background-color: var(--srf, #f5f5f5);
    border: 1px solid var(--out, #ccc);
    border-radius: calc(var(--rad, 0.25rem) / 4);
    color: var(--tx, #000);
    caret-color: var(--p, currentColor);
    transition: border-color var(--trans-d, 0.2s), box-shadow var(--trans-d, 0.2s);
}

:where(input:focus, select:focus, textarea:focus) {
    outline: none;
    border-color: var(--p, #eec14c);
    box-shadow: 0 0 0 3px var(--op-lt, rgba(238, 193, 76, 0.3));
}

:where(textarea) {
    resize: vertical;
    min-height: 5em;
}

:where(label) {
    display: block;
    font-weight: 600;
    margin-block-end: 0.5em;
    color: var(--t, #000);
}

:where(input[type="checkbox"], input[type="radio"]) {
    accent-color: var(--p, #eec14c);
    width: 1.25em;
    height: 1.25em;
    vertical-align: middle;
    margin-inline-end: 0.5em;
    cursor: pointer;
}

/* ==========================================================================
   7. TABLES
   ========================================================================== */

:where(table) {
    width: 100%;
    border-collapse: collapse;
    caption-side: bottom;
    margin-block: 0;
    /* Handled by Smart Flow */
}

:where(th) {
    text-align: start;
    font-weight: 700;
    color: var(--t, #000);
    background-color: var(--tbl-bg-head, var(--srf, #eee));
    padding: var(--tbl-pd, 0.75em);
}

:where(td) {
    padding: var(--tbl-pd, 0.75em);
    border-bottom: var(--tbl-bd-w, 1px) solid var(--tbl-bd-c, var(--out, #eee));
    color: var(--tx, #333);
}

:where(tr:hover td) {
    background-color: var(--tbl-bg-hover, var(--srf, #fafafa));
}

/* ==========================================================================
   8. UTILITIES (A11Y & Scroll)
   ========================================================================== */

:where(.sr-only) {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

:where(html)::-webkit-scrollbar {
    width: 10px;
}

:where(html)::-webkit-scrollbar-track {
    background: var(--srf, #eee);
}

:where(html)::-webkit-scrollbar-thumb {
    background-color: var(--out, #ccc);
    border-radius: calc(var(--rad, 0.25rem) * 2.5);
    border: 2px solid var(--srf, #eee);
}

:where(html)::-webkit-scrollbar-thumb:hover {
    background-color: var(--p, #eec14c);
}