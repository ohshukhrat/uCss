/**
 * @file HTML Reset & Defaults
 * @description Global element normalization. 
 * Connects "naked" HTML tags to the design system variables defined in config.css.
 * Now powered by "Smart Flow" variables for perfect vertical rhythm.
 * 
 * @usage
 * Load after config.css.
 * All selectors use :where() to maintain 0 specificity.
 */

/* ==========================================================================
   1. GLOBAL RESET & BOX SIZING
   ========================================================================== */

/* Focus Styles (A11y) */
:where(*:focus-visible) {
    outline: var(--focus-ring, 0.125rem solid var(--p, #eec14c));
    outline-offset: var(--focus-offset, 0.125rem);
}

:where(*:focus:not(:focus-visible)) {
    outline: none;
}

:where(*),
:where(*::before),
:where(*::after) {
    box-sizing: var(--box-sizing, border-box);
    background-repeat: no-repeat;
    min-width: var(--reset-min-w, 0);
}

:where(html) {
    scroll-behavior: var(--scroll-behavior, smooth);
    -webkit-text-size-adjust: var(--text-size-adjust, 100%);
    -moz-tab-size: var(--tab-size, 4);
    tab-size: var(--tab-size, 4);
}

@media (prefers-reduced-motion: reduce) {
    :where(html) {
        scroll-behavior: auto;
    }
}

/* ==========================================================================
   2. BODY & ROOT DEFAULTS
   ========================================================================== */

:where(body) {
    background-color: var(--bg, #ffffff);
    color: var(--tx, #000000);

    font-family: var(--tx-font-fam, system-ui, -apple-system, sans-serif);
    font-size: var(--body-font-size, var(--body-fs, var(--tx-fs, var(--tx-fs--s, 1rem))));
    line-height: var(--tx-lh, 1.5);
    font-weight: var(--tx-fw, 400);

    margin: 0;
    padding: 0;

    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* ==========================================================================
   3. TYPOGRAPHY & SMART FLOW
   ========================================================================== */

/* Headings: Map to --t (Title) variables */
:where(h1, h2, h3, h4, h5, h6) {
    color: var(--t, currentColor);
    font-family: var(--t-font-fam, inherit);
    font-weight: var(--t-fw--m, 700);
    line-height: var(--t-lh, 1.1);
    text-wrap: var(--t-tw, balance);

    /* Remove default margins, handled by flow */
    margin-block: 0;
}

/* Specific Sizes */
:where(h1) {
    font-size: var(--heading-font-size, var(--h-fs, var(--h-fs--xl, var(--t-fs, var(--t-fs--s, 2.625rem)))));
}

:where(h2) {
    font-size: var(--heading-font-size, var(--h-fs, var(--h-fs--l, var(--t-fs, var(--t-fs--xs, 2.25rem)))));
}

:where(h3) {
    font-size: var(--heading-font-size, var(--h-fs, var(--h-fs--m, var(--t-fs, var(--t-fs--xxs, 2rem)))));
}

:where(h4) {
    font-size: var(--heading-font-size, var(--h-fs, var(--h-fs--s, var(--t-fs, var(--t-fs--xxxs, 1.75rem)))));
}

:where(h5) {
    font-size: var(--heading-font-size, var(--h-fs, var(--h-fs--xs, var(--t-fs, var(--tx-fs--xxl, 1.625rem)))));
}

:where(h6) {
    font-size: var(--heading-font-size, var(--h-fs, var(--h-fs--xxs, var(--t-fs, var(--tx-fs--xl, 1.4375rem)))));
}

/* Paragraphs & Text */
:where(p) {
    margin-block: 0;
    max-width: var(--flow-max-width, 65ch);
}

:where(small) {
    font-size: 0.875em;
}

:where(b, strong) {
    font-weight: 700;
    color: var(--t, currentColor);
}



/* Links */
:where(a) {
    color: var(--link, var(--alt-bd, var(--p, #eec14c)));
    text-decoration: underline;
    text-decoration-thickness: var(--a-td-t, var(--bd-w, 1px));
    text-underline-offset: var(--a-td-o, 0.125em);
    transition: color var(--trans-d, 0.16s) ease, text-decoration-color var(--trans-d, 0.16s) ease;
}

:where(a:focus-visible) {
    outline: var(--link-focus-ring, 0.125rem solid var(--p, currentColor));
    outline-offset: var(--link-focus-offset, 0.125rem);
    text-decoration: none;
    border-radius: var(--rad--xs, 0.125em);
}

:where(a:hover) {
    color: var(--link-hover, var(--a, #eec14c));
}

/* Inline Code */
:where(code, kbd, samp) {
    font-family: var(--mono-font, monospace);
    font-size: var(--code-fs, 0.9em);
    padding: var(--code-pd, 0.1em 0.3em);
    border-radius: var(--code-rad, var(--rad--xs, 0.25em));
    background-color: var(--code-bg, var(--srf, #eee));
    color: var(--code-tx, var(--t, #000));
}

/* Preformatted blocks */
:where(pre) {
    background-color: var(--pre-bg, var(--d, #222));
    color: var(--pre-tx, var(--l, #fff));
    padding: var(--pre-pd, var(--gap, 1.5rem));
    border-radius: var(--rad--xs, 0.5rem);
    overflow-x: auto;
    font-family: var(--mono-font, monospace);
    font-size: var(--pre-fs, 0.9em);
    /* Margin handled by Smart Flow */
    margin-block: 0;
}

:where(hr) {
    border: none;
    border-block-start: var(--hr-h, 1px) solid var(--hr-c, var(--out, #ccc));
    margin-block: var(--hr-m, 2.5rem);
}

:where(blockquote) {
    border-inline-start: var(--bq-bd-w, calc(var(--border-width, .125rem) * 2)) solid var(--bq-bd-c, var(--p, currentColor));
    margin-inline: 0;
    padding-inline: var(--bq-pdi, 1.5em);
    padding-block: var(--bq-pdb, .5em);
    font-style: italic;
    color: var(--tx, var(--on-srf, var(--alt-bd, currentColor)));
    background-color: var(--bq-bg, var(--oter, var(--ontf, var(--srf, #eee))));
    /* Margin handled by Smart Flow */
    margin-block: 0;
}

/* Selection Color */
::selection {
    background-color: var(--p, #eec14c);
    color: var(--on-p, #000);
}

/* ==========================================================================
   4. MEDIA
   ========================================================================== */

:where(img, picture, video, canvas, svg) {
    display: block;
    max-width: 100%;
    height: auto;
    font-style: var(--med-font-style, italic);
    shape-margin: var(--shape-m, 1rem);

    /* SVG Specifics */
    fill: var(--svg-fill, initial);
    stroke: var(--svg-stroke, initial);
}

:where(img) {
    background-color: var(--srf, transparent);
}

/* ==========================================================================
   5. LISTS
   ========================================================================== */

:where(ul, ol) {
    padding-inline-start: var(--list-pis, var(--list-pi, 1.5em));
    margin-block: 0;
    /* Handled by Smart Flow */
}

:where(ul) {
    list-style: var(--ul-style, disc);
}

:where(ol) {
    list-style: var(--ol-style, decimal);
}

:where(li) {
    margin-block-end: 0;
    line-height: var(--tx-lh, 1.25);
    /* Handled by Smart Flow */
}

:where(li::marker) {
    color: var(--list-marker-c, var(--p, currentColor));
    font-weight: var(--list-marker-fw, bold);
    font-family: var(--list-marker-font, inherit);
}

/* ==========================================================================
   6. FORMS
   ========================================================================== */

:where(input, button, textarea, select) {
    font: inherit;
    color: inherit;
    letter-spacing: inherit;
}

/* Button (Minimal .btn mapping) */
:where(button, input[type="button"], input[type="submit"], input[type="reset"]) {
    cursor: var(--btn-cursor, pointer);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--btn-gap, 0.5em);

    font-weight: var(--btn-fw, 600);
    line-height: var(--btn-lh, 1.5);
    text-decoration: none;
    white-space: nowrap;

    padding: var(--btn-pd, var(--btn-pb, var(--btn-p, 0.625em)) var(--btn-pi, var(--btn-p, 1.325em)));
    background-color: var(--btn-bg, var(--p, #eec14c));
    color: var(--btn-c, var(--on-p, currentColor));

    border: var(--btn-bw, 0.125rem) solid var(--btn-bc, var(--btn-bg, #eec14c));
    border-radius: var(--btn-rad, var(--theme-button-border-radius, 4em));

    transform: var(--btn-tf, none);
    transition: var(--btn-trans, var(--trans-d, 0.32s) ease-in-out);
    transition-property: var(--btn-trans-p, background-color, border-color, color, opacity, transform);
}

:where(button:hover, input[type="button"]:hover, input[type="submit"]:hover, input[type="reset"]:hover) {
    background-color: var(--btn-bg-hover, var(--a, #ffb900));
    color: var(--btn-c-hover, var(--on-a, currentColor));
    border-color: var(--btn-bc-hover, var(--btn-bg-hover, #ffb900));

    transform: var(--btn-tf-hover, translatey(var(--tf-translatey, -0.125em)));
    transition: var(--btn-trans-hover, var(--trans-d-hover, 0.16s) ease-in-out);
}

:where(button:active, input[type="button"]:active, input[type="submit"]:active, input[type="reset"]:active) {
    transform: var(--btn-tf-active, translatey(var(--tf-translatey-active, 0.0625em)));
}

:where(button:focus-visible, input[type="button"]:focus-visible, input[type="submit"]:focus-visible, input[type="reset"]:focus-visible) {
    outline: var(--btn-outline, .25rem solid var(--btn-outline-c, var(--theme-palette-color-1, currentColor)));
    outline-offset: var(--btn-outline-offset, var(--btn-o-o, .125rem));
}

/* Inputs & Selects */
:where(input:not([type="button"], [type="submit"], [type="reset"], [type="checkbox"], [type="radio"], [type="range"], [type="file"], [type="color"]), select, textarea) {
    display: block;
    width: var(--input-w, 100%);
    padding: var(--input-pd, 0.625em 1em);
    background-color: var(--input-bg, var(--srf, #f5f5f5));
    border: var(--input-bd-w, 1px) solid var(--input-bd-c, var(--out, #ccc));
    border-radius: var(--input-rad, calc(var(--rad, 0.25rem) / 4));
    color: var(--tx, #000);
    caret-color: var(--p, currentColor);
    transition: border-color var(--trans-d, 0.2s), box-shadow var(--trans-d, 0.2s);
}

:where(select) {
    appearance: none;
    background-image: var(--select-arrow, url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236B7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3E%3C/svg%3E"));
    background-position: right 0.5em center;
    background-repeat: no-repeat;
    background-size: 1.5em 1.5em;
    padding-right: 2.5em;
}

:where(input:focus-visible, select:focus-visible, textarea:focus-visible) {
    outline: none;
    border-color: var(--input-focus-bd-c, var(--p, #eec14c));
    box-shadow: 0 0 0 var(--input-focus-ring-w, 3px) var(--input-focus-ring-c, var(--op-lt, rgba(238, 193, 76, 0.3)));
}

:where(input:focus, select:focus, textarea:focus) {
    outline: none;
    /* Legacy focus for non-visible interaction should handle same style */
    border-color: var(--input-focus-bd-c, var(--p, #eec14c));
}

:where(textarea) {
    resize: vertical;
    min-height: 5em;
}

:where(label) {
    display: block;
    font-weight: 600;
    margin-block-end: var(--label-mbe, 0.5em);
    color: var(--t, #000);
}

:where(input[type="checkbox"], input[type="radio"]) {
    accent-color: var(--p, #eec14c);
    width: var(--chk-s, 1.25em);
    height: var(--chk-s, 1.25em);
    vertical-align: middle;
    margin-inline-end: var(--chk-mie, 0.5em);
    cursor: pointer;
}

/* Fieldset & Legend */
:where(fieldset) {
    border: var(--fieldset-bd-w, 1px) solid var(--fieldset-bd-c, var(--out, #ccc));
    border-radius: var(--fieldset-rad, var(--rad, 0.5rem));
    padding: var(--fieldset-pd, 1em);
    margin-inline: 0;
}

:where(legend) {
    padding-inline: 0.5em;
    font-weight: 600;
    color: var(--t, currentColor);
}

:where(summary) {
    cursor: pointer;
    list-style: none;
}

:where(summary:focus-visible) {
    outline: var(--focus-ring, 0.125rem solid var(--p, #eec14c));
    outline-offset: var(--focus-offset, 0.125rem);
    border-radius: var(--rad--xs, 0.25rem);
}

:where(summary)::-webkit-details-marker {
    display: none;
}

/* ==========================================================================
   7. TABLES
   ========================================================================== */

:where(table) {
    width: var(--tbl-w, 100%);
    border-collapse: var(--tbl-border-collapse, collapse);
    caption-side: var(--tbl-caption-side, bottom);
    margin-block-start: var(--tbl-mbs, 0);
    margin-block-end: var(--tbl-mbe, 0);
    /* Handled by Smart Flow */
}

:where(th) {
    text-align: var(--tbl-th-ta, start);
    font-weight: var(--tbl-th-fw, var(--t-fw, 700));
    color: var(--t, #000);
    background-color: var(--tbl-bg-head, var(--srf, #eee));
    padding: var(--tbl-pd, 0.75em);
}

:where(td) {
    padding: var(--tbl-pd, 0.75em);
    border-bottom: var(--tbl-bd-w, 1px) solid var(--tbl-bd-c, var(--out, #131313));
    color: var(--tx, #333);
}

:where(tr:hover td) {
    background-color: var(--tbl-bg-hover, var(--srf, #fafafa));
}

/* ==========================================================================
   8. UTILITIES (A11Y & Scroll)
   ========================================================================== */

:where(.sr-only) {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

:where(html)::-webkit-scrollbar {
    width: var(--scrollbar-w, 0.625rem);
}

:where(html)::-webkit-scrollbar:hover {
    width: var(--scrollbar-w-hover, 1rem);
}

:where(html)::-webkit-scrollbar-track {
    background: var(--srf, #eee);
}

:where(html)::-webkit-scrollbar-thumb {
    background-color: var(--out, #ccc);
    border-radius: calc(var(--rad, 0.25rem) * 2.5);
    border: 2px solid var(--srf, #eee);
}

:where(html)::-webkit-scrollbar-thumb:hover {
    background-color: var(--p, #eec14c);
}

/* ==========================================================================
   9. SMART FLOW LOGIC (The Engine)
   ========================================================================== */

/* 1. Standard Flow (Paragraphs, Lists) */
:where(p, ul, ol, blockquote, figure, pre, table)+ :where(p, ul, ol, blockquote, figure, pre, table) {
    margin-block-start: var(--p-flow, 0.75em);
}

/* 2. Heading Flow */
/* Space BEFORE headings (if not first child) */
:where(*:not(h1, h2, h3, h4, h5, h6))+ :where(h1, h2, h3, h4, h5, h6) {
    margin-block-start: var(--t-flow-s, 1em);
}

/* Space AFTER headings (connecting to text) */
:where(h1, h2, h3, h4, h5, h6)+ :where(p, ul, ol, blockquote, figure, pre, table) {
    margin-block-end: var(--t-flow-e, 0.375em);
}

/* 3. List Item Flow */
:where(li)+ :where(li) {
    margin-block-start: var(--li-flow, 0.5em);
}

/* 4. Button/Link After Flow */
:where(p)+ :where(a, button, .btn) {
    margin-block-start: var(--p-flow, 0.75em);
}