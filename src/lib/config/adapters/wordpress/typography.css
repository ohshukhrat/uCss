/**
 * @file WordPress Smart Flow and Typography Size Adapter
 * @description The vertical rhythm engine that manages spacing between flow elements.
 */

/* Typography Size */

:is(h1, h2, h3, h4, h5, h6).wp-block-heading {
    color: var(--t, currentColor);
    font-family: var(--t-font-fam, inherit);
    font-weight: var(--t-fw, var(--t-fw--m, 700));
    line-height: var(--t-lh, 1.25);
    text-wrap: var(--t-tw, balance);

    /* Remove default margins, handled by flow */
    margin: var(--heading-margin, 0);
}

body h1:not(.t, .tx) {
    font-size: var(--heading-font-size, var(--h1-fs, var(--h-fs, var(--h-fs--xl, var(--t-fs, var(--t-fs--s, 2.625rem))))));
}

body h2:not(.t, .tx) {
    font-size: var(--heading-font-size, var(--h2-fs, var(--h-fs, var(--h-fs--l, var(--t-fs, var(--t-fs--xs, 2.25rem))))));
}

body h3:not(.t, .tx) {
    font-size: var(--heading-font-size, var(--h3-fs, var(--h-fs, var(--h-fs--m, var(--t-fs, var(--t-fs--xxs, 2rem))))));
}

body h4:not(.t, .tx) {
    font-size: var(--heading-font-size, var(--h4-fs, var(--h-fs, var(--h-fs--s, var(--t-fs, var(--t-fs--xxxs, 1.75rem))))));
}

body h5:not(.t, .tx) {
    font-size: var(--heading-font-size, var(--h5-fs, var(--h-fs, var(--h-fs--xs, var(--t-fs, var(--tx-fs--xxl, 1.625rem))))));
}

body h6:not(.t, .tx) {
    font-size: var(--heading-font-size, var(--h6-fs, var(--h-fs, var(--h-fs--xxs, var(--t-fs, var(--tx-fs--xl, 1.4375rem))))));
}

/* Paragraphs & Text */
body p:not(.t, .tx) {
    font-size: var(--paragraph-font-size, var(--p-fs, var(--tx-fs, var(--tx-fs--s, 1rem))));
}

body p {
    margin-block: 0;
    max-width: var(--paragraph-max-width, var(--flow-max-w));
}

/*
 * Smart Flow
 */

/* 1. Standard Flow (Paragraphs, Lists) */
body :is(p, ul, ol, blockquote, figure, pre, table, form, image, video, iframe, canvas, div, a, h1, h2, h3, h4, h5, h6)+ :is(p, pre) {
    margin-top: var(--p-flow, .75em);
    margin-block-start: var(--p-flow, .75em);
    margin-bottom: var(--p-flow-e, 0);
    margin-block-end: var(--p-flow-e, 0);
}

body :is(p, ul, ol, blockquote, figure, pre, table, form, image, video, iframe, canvas, div, a, h1, h2, h3, h4, h5, h6)+ :is(ul, ol, blockquote, figure, pre, table) {
    margin-top: var(--el-flow, .75em);
    margin-block-start: var(--el-flow, 1.25em);
    margin-bottom: var(--el-flow-e, 0);
    margin-block-end: var(--el-flow-e, 0);
}

/* 2. Heading Flow */
/* Space BEFORE headings (if not first child) */
body :is(p, ul, ol, blockquote, figure, pre, table, form, image, video, iframe, canvas, div, a, h1, h2, h3, h4, h5, h6)+ :is(h1, h2, h3, h4, h5, h6) {
    margin-top: var(--t-flow-s, .75em);
    margin-block-start: var(--t-flow-s, 1em);
}

/* Space AFTER headings (connecting to text, or subtitle) */
body :is(h1, h2, h3, h4, h5, h6):not(:last-child) {
    margin-bottom: var(--t-flow-e, .375em);
    margin-block-end: var(--t-flow-e, .375em);
}

/* 3. List Item Flow */
body :is(li, a, div)+ :is(li) {
    margin-top: var(--li-flow, .5em);
    margin-block-start: var(--li-flow, .5em);
    margin-bottom: var(--li-flow-e, 0);
    margin-block-end: var(--li-flow-e, 0);
}

body :is(li, li > *)+ :is(ul, ol) {
    margin-top: var(--li-flow, .5em);
    margin-block-start: var(--li-flow, .5em);
    margin-bottom: var(--li-flow-e, 0);
    margin-block-end: var(--li-flow-e, 0);
}

/* 4. Button/Link After Flow */
body :is(p)+ :is(a, button, .btn) {
    margin-top: var(--p-flow, .75em);
    margin-block-start: var(--p-flow, .75em);
    margin-bottom: var(--p-flow-e, 0);
    margin-block-end: var(--p-flow-e, 0);
}

/* 5. Table Inner Flow */
body :is(div)> :is(table:only-child) {
    margin-top: var(--p-flow, .75em);
    margin-block-start: var(--p-flow, .75em);
    margin-bottom: var(--p-flow-e, 0);
    margin-block-end: var(--p-flow-e, 0);
}

/* Typography Styles */

/* Inline Code */
body :is(code, kbd, samp) {
    font-family: var(--mono-font, monospace);
    font-size: var(--code-fs, 0.875em);
    padding: var(--code-pd, 0.1em 0.3em);
    border-radius: var(--code-rad, var(--rad--xs, 0.25em));
    color: var(--code-tx, var(--bg-bd, var(--base-bd, #ececec)));
    background-color: var(--code-bg, var(--og-lt, hsl(0 0% 50% / .32)));
}

/* Preformatted blocks */
body :is(pre) {
    --set-c: var(--l, #f5f5f5);
    color: var(--pre-tx, var(--set-c, var(--l, #f5f5f5)));
    --set-bg: var(--d-bd, #0a0a0a);
    background-color: var(--pre-bg, var(--set-bg, var(--d-bd, #0a0a0a)));
    padding: var(--pre-pd, var(--gap, 1.5rem));
    border-radius: var(--rad--xs, 0.5rem);
    overflow-x: auto;
    font-family: var(--mono-font, monospace);
    font-size: var(--pre-fs, 0.875em);
    line-height: var(--pre-lh, 1.375em);
    /* Margin handled by Smart Flow */
    margin-block: 0;
}

body :is(pre) :is(code, kbd, samp) {
    --set-c: var(--l, #f5f5f5);
    color: var(--pre-tx, var(--set-c, var(--l, #f5f5f5)));
}

body :is(hr) {
    border: none;
    border-block-start: var(--hr-h, 1px) solid var(--hr-c, var(--og-lt, hsl(0 0% 50% / .32)));
    --mg: var(--hr-m, 2.5rem);
    --mgb: var(--mg);
    margin-block: var(--mgb, var(--mg, var(--hr-m, 2.5rem)));
}

body :is(blockquote) {
    --set-bc: var(--out-p, var(--p, currentColor));
    border-inline-start: var(--bq-bd-w, calc(var(--border-width, .125rem) * 2)) solid var(--bq-bd-c, var(--set-bc, var(--out-p, var(--p, currentColor))));
    margin-inline: 0;
    padding-inline: var(--bq-pdi, 1.5em);
    padding-block: var(--bq-pdb, .5em);
    font-style: italic;
    color: var(--bq-tx, var(--set-c, var(--alt-bd, var(--on-srf, var(--tx, currentColor)))));
    --set-bg: var(--op-lt, var(--oter, var(--ontf, hsl(43 83% 62% / .32))));
    background-color: var(--bq-bg, var(--set-bg));
    /* Margin handled by Smart Flow */
    margin-block: 0;
}

/* Links */
body :is(a):not(.wp-element-button, .btn) {
    color: var(--link, var(--lnk, var(--p, var(--t, currentColor))));
    background-color: var(--link-bg, var(--lnk-bg, transparent));
    text-decoration: var(--link-text-decoration, var(--lnk-td, underline));
    text-decoration-thickness: var(--link-text-decoration-thickness, var(--lnk-td-t, var(--bd-w, 1px)));
    text-underline-offset: var(--link-text-decoration-offset, var(--lnk-td-o, 0.125em));
    transition: var(--lnk-trans, var(--trans-d, 0.16s) ease-in-out);
    transition-property: var(--lnk-trans-p, color, text-decoration-color, opacity);
    opacity: var(--link-opacity, var(--lnk-op, 1));
}

body :is(a:focus-visible):not(.wp-element-button, .btn) {
    outline: var(--link-focus-ring, 0.125rem solid var(--p, currentColor));
    outline-offset: var(--link-focus-offset, 0.125rem);
    text-decoration: none;
    border-radius: var(--link-focus-radius, var(--rad--xs, 0.125em));
}

body :is(a:hover):not(.wp-element-button, .btn) {
    color: var(--link-hover, var(--lnk-hover, var(--set-a, var(--a, #eec14c))));
    background-color: var(--link-bg-hover, var(--lnk-bg-hover, transparent));
    text-decoration: var(--link-text-decoration-hover, var(--lnk-td-hover, underline));
    opacity: var(--link-opacity-hover, var(--lnk-op-hover, var(--set-lnk-op-hover, var(--lnk-op-hover, 1))));

    >* {
        color: inherit;
    }
}

body :is(pre, code, kbd, samp, blockquote, table, td) :is(a:hover) {
    --lnk-hover: var(--set-a, var(--alt-bd, var(--contrast, #000)));
    color: var(--bq-link-hover, var(--set-link-hover, var(--lnk-hover, var(--t, var(--alt-bd, var(--contrast, #000))))));
    opacity: var(--bq-link-opacity-hover, var(--set-link-op-hover, var(--lnk-op-active, 1)));
}

.set {
    color: var(--set-text, var(--set-tx, var(--set-color, var(--set-c, var(--tx, currentColor)))));

    :is(h1, h2) {
        color: var(--set-title, var(--set-t, var(--set-heading, var(--set-h, var(--set-color, var(--set-c, var(--t, currentColor)))))));
    }

    :is(h3, h4, h5, h6) {
        color: var(--set-subtitle, var(--set-st, var(--set-heading, var(--set-h, var(--set-color, var(--set-c, var(--t, currentColor)))))));
    }

    :is(a):not(.btn, [data-style="btn"]) {
        color: var(--set-link, var(--set-lnk, var(--set-p, var(--set-h, var(--set-color, var(--set-c, var(--lnk, var(--p, var(--t, currentColor)))))))));
        color: var(--set-link-hover, var(--set-lnk-hover, var(--set-a, var(--lnk-hover, var(--a, currentColor)))));
    }
}